### 说明

- dubbo-common：公共模块
- dubbo-order：订单模块，由此调用下单接口- > 生成订单 -> 调用account服务增减账户余额
- dubbo-account：账户模块

dubbo-order服务使用order数据库

dubbo-account服务使用account数据库



我这里暂时没有设置用户A B分别两个数据库，而是简单的用户A人民币兑换美元，人民币账户余额减少，美元账户余额增加。下单的时候，会生成订单记录以及账户余额会进行增减，涉及到的分布式事务为order库和account库。

order模块有两个接口，一个正常情况，一个异常情况，事务回滚。



### 关于Hmily-TCC的疑问

tcc 分别对应 try，confirm，cancel 三阶段；

假如<font color=red> try 执行成功，然后执行 confirm 阶段，但是 confirm 执行失败了，虽然概率极低</font>。拿上面的例子来讲，人民币兑换美元：

1. try 阶段执行成功：人民币账户冻结数量增加，可以数量减少，总数量不变。
2. confirm 阶段执行失败：人民币账户余额情况和 try 阶段还是一样。正确的应该是：冻结数量减少，可用不变，总数量减少。

TCC 貌似对于上面这种情况是没有处理的，我们只能通过日志查看情况，假如发生这种情况，是不是说需要**人工手动处理呢**？



此外，看 hmily 的官方示例，貌似 confirm 和 cancel 阶段有可能执行多次，可能是为了应对上面的情况，但是具体如何设置暂未找到。